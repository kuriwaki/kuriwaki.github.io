<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Math Camp R Sessions</title>
    <meta charset="utf-8" />
    <meta name="author" content="Shiro Kuriwaki" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <script src="libs/kePrint/kePrint.js"></script>
    <link rel="stylesheet" href="xaringan_style.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Math Camp R Sessions
## Welcome!
### Shiro Kuriwaki
### August 2019

---










# Rough Schedule

&lt;img src="images/data-science.png" width="80%" style="display: block; margin: auto;" /&gt;

.small[Source: Grolemund and Wickham, R for Data Science]

---

# Rough Schedule


.pull-left[
## Topics

1. Mastering R basics in tidyverse 
2. Mastering R basics beyond tidyverse
3. Perfecting Graphs
4. Exporting and Presenting
5. Presentations, preparing for classes

.small[\* See syllabus on Canvas for details]
]

--

.pull-right[

## Logistics


1. Login to &lt;https://rstudio.cloud&gt; and go to the Math Camp class space
2. "Copy" the Day 1 project `02_Day-01`, which includes
  - satasets
  - exercise PDF
  - relevant packages
3. During slides, try the code yourself + consult the cheatsheet: &lt;http://bit.ly/HKS-R&gt;
4. Work in groups for exercises (in your own R scripts)
5. Interrupt with questions and give me feedback on your index cards.


]


---
class: middle center

# Day 1: Basics of tidyverse

## dplyr verbs
## ggplot aesthetics
## functions

---

# What is tidyverse?

* A popular suite of R packages
* Has its own syntax, designed to be more intuitive

--

&lt;br&gt;

&lt;mark&gt;For someone who does not know ANY programming, which of these two is more intuitive?&lt;/mark&gt;

--

.pull-left[

## (a) tidyverse syntax


```r
weo_dataset %&gt;% 
  group_by(continent) %&gt;% 
	summarize(gdp = median(rgdp2017, na.rm = TRUE))
```

]

.pull-right[

## (b) base-R syntax


```r
aggregate(weo_dataset[, "rgdp2017"], 
          list(continent = weo_dataset[, "continent"]), 
          median, na.rm = TRUE)
```

]

--

.small[.right[Source: Adapted from Roger Peng, &lt;a href= "https://simplystatistics.org/2018/07/12/use-r-keynote-2018/"&gt;"Teaching R to New Users - From tapply to the Tidyverse"&lt;/a&gt;]]

---

# If learning R is like "learning a language", R is a very _fast-evolving_ language

&lt;br&gt;
&lt;br&gt;
&lt;br&gt;

&lt;img src="images/tikz_timeline.png" width="120%" style="display: block; margin: auto;" /&gt;

---
class: left

# tidyverse simplifies data analysis by focusing on "tidy" rectangular data. 


```r
weo &lt;- read_excel("data/input/WEO-2018.xlsx")
```

.small[
&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; country &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; continent &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; pop1992 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; rgdp1992 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; pop1994 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; pop1995 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; pop1996 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; pop1997 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; pop1998 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; pop1999 &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Afghanistan &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Asia &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Albania &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Europe &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.217 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9728.893 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.137 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.141 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.168 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.148 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.129 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.109 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Algeria &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Africa &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 26.271 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 267807.178 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 27.496 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 28.060 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 28.566 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 29.045 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 29.507 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 29.965 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Angola &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Africa &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 13.459 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 39709.339 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 14.279 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 14.707 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 15.148 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 15.603 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 16.071 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 16.553 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Antigua and Barbuda &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; North America &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.062 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1133.675 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.065 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.067 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.068 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.070 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.072 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.074 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Argentina &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; South America &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 33.420 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 445025.532 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 34.353 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 34.779 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 35.196 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 35.604 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 36.005 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 36.399 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Armenia &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Asia &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.450 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7153.161 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.290 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.220 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.170 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.140 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.110 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.090 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Australia &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Oceania &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 17.557 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 507554.453 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 17.893 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 18.120 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 18.330 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 18.510 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 18.706 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 18.919 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]


---



# The `dplyr` package


* __94 percent__ of you responded being "Very Comfortable" or "Comfortable" using Excel

--

* `dplyr` ["dee" - plier] is a package that provides common spreadsheet manipulations

--

## single verbs

.pull-left[

* `filter()`: Return __rows__ with matching conditions
* `select()`: Select/rename __variables__ by name
* `arrange()`: Arrange rows by variables
* `mutate()`: Create or transform variables
* `summarize()`: Reduce multiple values down to a single value

* `%&gt;%` ["and then"]: Pipe left hand-side into right hand side

]

.pull-right[


```r
weo %&gt;% filter(continent == "Europe")
```


```r
weo %&gt;% arrange(rgdp2010)
```


```r
weo %&gt;% select(rgdp2010)
```


```r
weo %&gt;% mutate(gdp_pc_2010 = rgdp2010 / pop2010)
```


```r
weo %&gt;% summarize(median_pop_2017 = median(pop2017))
```

]


---

# A good package offers tools for common use cases

--


## selecting the first 10 columns


```r
weo %&gt;% select(1:10)
```

## selecting values from 1992 (i.e., variables that include the number 1992.)


```r
weo %&gt;% select(matches("1992"))
```

## select and rename 


```r
weo %&gt;% select(country, continent, `real_gdp_2017 = `rgdp2017)
```

## move 2017 to the beginning


```r
weo %&gt;% select(country, continent, matches("2017"), `everything()`)
```


See the help page of `?select` for more.

---

# A common summary -- counting


```r
count(weo, continent)
```

```
## # A tibble: 6 x 2
##   continent         n
##   &lt;chr&gt;         &lt;int&gt;
## 1 Africa           55
## 2 Asia             43
## 3 Europe           45
## 4 North America    22
## 5 Oceania          13
## 6 South America    13
```

---

# Cross-tabulation via counting

.pull-left[

```r
data(gss_cat)
count(gss_cat, race)
```

```
## # A tibble: 3 x 2
##   race      n
##   &lt;fct&gt; &lt;int&gt;
## 1 Other  1959
## 2 Black  3129
## 3 White 16395
```


```r
count(gss_cat, race, `sort = TRUE`)
```

```
## # A tibble: 3 x 2
##   race      n
##   &lt;fct&gt; &lt;int&gt;
## 1 White 16395
## 2 Black  3129
## 3 Other  1959
```

]

--

.pull-right[

```r
count(gss_cat, race, relig)
```

```
## # A tibble: 44 x 3
##    race  relig                       n
##    &lt;fct&gt; &lt;fct&gt;                   &lt;int&gt;
##  1 Other No answer                  14
##  2 Other Don't know                  3
##  3 Other Inter-nondenominational     2
##  4 Other Native american            16
##  5 Other Christian                  74
##  6 Other Orthodox-christian          1
##  7 Other Moslem/islam               42
##  8 Other Other eastern              10
##  9 Other Hinduism                   62
## 10 Other Buddhism                   72
## # … with 34 more rows
```
]

---

# Doing more with dplyr: `group_by`


```r
weo %&gt;% 
* group_by(continent) %&gt;%
  summarize(median_gdp_pc = median(rgdp2017 / pop2017))
```

```
## # A tibble: 6 x 2
##   continent     median_gdp_pc
##   &lt;chr&gt;                 &lt;dbl&gt;
## 1 Africa                3180.
## 2 Asia                 15443.
## 3 Europe               30082.
## 4 North America        14484.
## 5 Oceania               5109.
## 6 South America        13194.
```

--

&lt;mark&gt;How would you write the equivalent of `count` with `group_by`?&lt;/mark&gt;

--


```r
weo %&gt;% 
  group_by(continent) %&gt;% 
  summarize(n = n())
```

---

# Grouping + dplyr verbs is a large part of data analysis


.left-code-wide[

```r
drop_inc &lt;- c("No answer", "Not applicable", "Don't know", "Refused")
gop_ind &lt;- c("Not str republican", "Strong republican")

gss_cat %&gt;% 
  filter(race != "Other", 
         !rincome %in% drop_inc) %&gt;% 
  mutate(race = fct_infreq(race)) %&gt;% 
* group_by(race, rincome) %&gt;%
  summarize(is_R = mean(partyid %in% gop_ind)) %&gt;% 
  pivot_wider(id_cols = rincome, 
              names_from = race,
              values_from = is_R) %&gt;% 
  kable(format = "html", 
        digits = 2,
        col.names = c("Income", "Whites", "Blacks")) %&gt;% 
  add_header_above(c(" " = 1, "% Strong Republican among" = 2))
```

.small[\* don't worry about the code for now. The only point here is that `group_by` is crucial.]
]

.right-plot-narrow[
.small[
&lt;table&gt;
 &lt;thead&gt;
&lt;tr&gt;
&lt;th style="border-bottom:hidden" colspan="1"&gt;&lt;/th&gt;
&lt;th style="border-bottom:hidden; padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2"&gt;&lt;div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; "&gt;% Strong Republican among&lt;/div&gt;&lt;/th&gt;
&lt;/tr&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Income &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Whites &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Blacks &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; $25000 or more &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.34 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.05 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; $20000 - 24999 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.28 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.05 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; $15000 - 19999 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.27 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.03 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; $10000 - 14999 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.25 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.06 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; $8000 to 9999 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.23 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.11 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; $7000 to 7999 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.24 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.00 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; $6000 to 6999 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.26 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.03 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; $5000 to 5999 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.28 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.08 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; $4000 to 4999 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.29 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.08 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; $3000 to 3999 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.26 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.10 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; $1000 to 2999 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.27 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.00 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Lt $1000 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.24 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.04 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]
]


---

# Introducing a new dataset

.pull-left[

The WEO dataset in "long" form



```r
weo_long
```

```
## # A tibble: 6,112 x 5
##    country     continent  year   pop  rgdp
##    &lt;chr&gt;       &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 Afghanistan Asia       1992    NA    NA
##  2 Afghanistan Asia       1993    NA    NA
##  3 Afghanistan Asia       1994    NA    NA
##  4 Afghanistan Asia       1995    NA    NA
##  5 Afghanistan Asia       1996    NA    NA
##  6 Afghanistan Asia       1997    NA    NA
##  7 Afghanistan Asia       1998    NA    NA
##  8 Afghanistan Asia       1999    NA    NA
##  9 Afghanistan Asia       2000    NA    NA
## 10 Afghanistan Asia       2001    NA    NA
## # … with 6,102 more rows
```


]

--

.pull-right[

compare this to the original "wide" form....


```r
weo
```

```
## # A tibble: 191 x 66
##    country continent pop1992 pop1993 pop1994 pop1995 pop1996 pop1997
##    &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1 Afghan… Asia       NA      NA      NA      NA      NA       NA   
##  2 Albania Europe      3.22    3.20    3.14    3.14    3.17     3.15
##  3 Algeria Africa     26.3    26.9    27.5    28.1    28.6     29.0 
##  4 Angola  Africa     13.5    13.9    14.3    14.7    15.1     15.6 
##  5 Antigu… North Am…   0.062   0.063   0.065   0.067   0.068    0.07
##  6 Argent… South Am…  33.4    33.9    34.4    34.8    35.2     35.6 
##  7 Armenia Asia        3.45    3.37    3.29    3.22    3.17     3.14
##  8 Austra… Oceania    17.6    17.7    17.9    18.1    18.3     18.5 
##  9 Austria Europe      7.80    7.88    7.93    7.95    7.96     7.97
## 10 Azerba… Asia        7.46    7.49    7.60    7.64    7.73     7.8 
## # … with 181 more rows, and 58 more variables: pop1998 &lt;dbl&gt;,
## #   pop1999 &lt;dbl&gt;, pop2000 &lt;dbl&gt;, pop2001 &lt;dbl&gt;, pop2002 &lt;dbl&gt;,
## #   pop2003 &lt;dbl&gt;, pop2004 &lt;dbl&gt;, pop2005 &lt;dbl&gt;, pop2006 &lt;dbl&gt;,
## #   pop2007 &lt;dbl&gt;, pop2008 &lt;dbl&gt;, pop2009 &lt;dbl&gt;, pop2010 &lt;dbl&gt;,
## #   pop2011 &lt;dbl&gt;, pop2012 &lt;dbl&gt;, pop2013 &lt;dbl&gt;, pop2014 &lt;dbl&gt;,
## #   pop2015 &lt;dbl&gt;, pop2016 &lt;dbl&gt;, pop2017 &lt;dbl&gt;, pop2018 &lt;dbl&gt;,
## #   pop2019 &lt;dbl&gt;, pop2020 &lt;dbl&gt;, pop2021 &lt;dbl&gt;, pop2022 &lt;dbl&gt;,
## #   pop2023 &lt;dbl&gt;, rgdp1992 &lt;dbl&gt;, rgdp1993 &lt;dbl&gt;, rgdp1994 &lt;dbl&gt;,
## #   rgdp1995 &lt;dbl&gt;, rgdp1996 &lt;dbl&gt;, rgdp1997 &lt;dbl&gt;, rgdp1998 &lt;dbl&gt;,
## #   rgdp1999 &lt;dbl&gt;, rgdp2000 &lt;dbl&gt;, rgdp2001 &lt;dbl&gt;, rgdp2002 &lt;dbl&gt;,
## #   rgdp2003 &lt;dbl&gt;, rgdp2004 &lt;dbl&gt;, rgdp2005 &lt;dbl&gt;, rgdp2006 &lt;dbl&gt;,
## #   rgdp2007 &lt;dbl&gt;, rgdp2008 &lt;dbl&gt;, rgdp2009 &lt;dbl&gt;, rgdp2010 &lt;dbl&gt;,
## #   rgdp2011 &lt;dbl&gt;, rgdp2012 &lt;dbl&gt;, rgdp2013 &lt;dbl&gt;, rgdp2014 &lt;dbl&gt;,
## #   rgdp2015 &lt;dbl&gt;, rgdp2016 &lt;dbl&gt;, rgdp2017 &lt;dbl&gt;, rgdp2018 &lt;dbl&gt;,
## #   rgdp2019 &lt;dbl&gt;, rgdp2020 &lt;dbl&gt;, rgdp2021 &lt;dbl&gt;, rgdp2022 &lt;dbl&gt;,
## #   rgdp2023 &lt;dbl&gt;
```

]


---

# groups in ggplot

## simple case: single time trend
.left-code[

```r
gdp_by_year &lt;- weo_long %&gt;% 
  group_by(year) %&gt;% 
  summarize(med_gdp = median(rgdp, na.rm = TRUE),
            gdp_pc = sum(rgdp, na.rm = TRUE) / 
              sum(pop, na.rm = TRUE))

ggplot(gdp_by_year, aes(x = year, med_gdp)) +
  geom_line() +
  labs(y = "Median GDP (in millions 2017 USD)")
```
]

--


.right-plot[
![](2019-math-camp-R_day-01_files/figure-html/lineall-out-1.svg)&lt;!-- --&gt;
]

---

# groups in ggplot

## what's wrong here?

.left-code[

```r
ggplot(weo_long, aes(x = year, rgdp)) +
  geom_line() +
  labs(y = "GDP (in millions 2017 USD)")
```
]

.right-plot[
![](2019-math-camp-R_day-01_files/figure-html/linectybad-out-1.svg)&lt;!-- --&gt;
]

---

# groups in ggplot

## the group aesthetic treats a group of observations, defined by another variable, separately

.left-code[

```r
ggplot(weo_long, 
*      aes(x = year, y = rgdp, group = country)) +
  geom_line() +
  labs(y = "GDP (in millions 2017 USD)")
```
]

.right-plot[
![](2019-math-camp-R_day-01_files/figure-html/linecty-out-1.svg)&lt;!-- --&gt;
]

---

# groups in ggplot


.left-code[

```r
weo_large &lt;- weo_long %&gt;% 
  filter(country %in% c(
    "India",
    "China",
    "Japan",
    "South Korea",
    "United States"
  ))


ggplot(weo_large, 
*      aes(x = year, y = rgdp, group = country)) +
  geom_line() +
  labs(y = "GDP (in millions 2017 USD)")
```
]

.right-plot[
![](2019-math-camp-R_day-01_files/figure-html/linectysub-out-1.svg)&lt;!-- --&gt;
]

---
class: middle, center

# The grammar of graphics


---
# 3 required components of ggplot grammar: data, aesthetic mapping, and geoms


&lt;img src="images/ggplot-grammar.png" width="70%" style="display: block; margin: auto;" /&gt;

---

# mapping vs. layers and the global application of geoms

.left-threeway[


```r
#
ggplot(data = gdp_by_year, 
       aes(x = year, y = gdp_pc)) +
* geom_point() +
  labs(x = "Year",
       y = "GDP per capita")
```

&lt;img src="2019-math-camp-R_day-01_files/figure-html/unnamed-chunk-29-1.svg" width="100%" /&gt;

]

--

.center-threeway[

```r
#
ggplot(data = gdp_by_year, 
       aes(x = year, y = gdp_pc)) +
* geom_line() +
  labs(x = "Year",
       y = "GDP per capita")
```

&lt;img src="2019-math-camp-R_day-01_files/figure-html/unnamed-chunk-30-1.svg" width="100%" /&gt;

]

--

.right-threeway[


```r
ggplot(data = gdp_by_year, 
       aes(x = year, y = gdp_pc)) +
* geom_point() +
* geom_line() +
  labs(x = "Year",
       y = "GDP per capita")
```

&lt;img src="2019-math-camp-R_day-01_files/figure-html/unnamed-chunk-31-1.svg" width="100%" /&gt;

]

---

# mappings vs. hard-coded values

.left-threeway[

```r
ggplot(data = gdp_by_year, 
       aes(x = year, y = gdp_pc)) +
* geom_point(aes(color = gdp_pc)) +
  labs(x = "Year",
       y = "GDP per capita")
```

&lt;img src="2019-math-camp-R_day-01_files/figure-html/unnamed-chunk-32-1.svg" width="100%" /&gt;

]

--



.center-threeway[

```r
ggplot(data = gdp_by_year, 
       aes(x = year, y = gdp_pc)) +
* geom_line(color = "navy") +
  labs(x = "Year",
       y = "GDP per capita")
```

&lt;img src="2019-math-camp-R_day-01_files/figure-html/unnamed-chunk-33-1.svg" width="100%" /&gt;

]

--



.right-threeway[


```r
ggplot(data = gdp_by_year, 
       aes(x = year, y = gdp_pc)) +
* geom_point(aes(color = "navy")) + # wrong!
  labs(x = "Year",
       y = "GDP per capita")
```

&lt;img src="2019-math-camp-R_day-01_files/figure-html/unnamed-chunk-34-1.svg" width="100%" /&gt;

]

---
class: middle, center

# Function Anatomy

---

* _function_ (in mathematics): a process that associates to each element of a set `\(X\)` a single element of a set `\(Y\)`"

    In R: a process that takes one or more inputs (in parentheses) and returns exactly one output
    
    ```r
    log(x = 100, base = 10)
    ```

--


* Call a function by the function name, with arguments and values in parentheses, separated by commas
    
    ```r
    log(x = 100, base = 10)
    log(base = 10, x = 100)
    ```

--



* If the user does not name the arguments, they are assumed to come in the order they are defined.
    
    ```r
    log(100, 10)
    ```

--


* &lt;mark&gt;How do you know that the first argument of `log()` is `x`, and not `base`?&lt;/mark&gt;

---

# Function anatomy: important odds and ends

.pull-left[

## functions with no output

-- 

These functions still do something, but they are side-effects (no object output)


```r
library(tidyverse)
```
.small[.right[(loads the package)]]

&lt;br&gt;


```r
data(gss_cat)
```
.small[.right[(loads a built-in dataset which will be called `gss_cat`)]]

]

--

.pull-right[

## functions with no arguments

--


```r
Sys.Date()
```

```
## [1] "2019-08-15"
```

.small[.right[(prints the date regardless of input)]]


```r
n()
```
.small[.right[(`dplyr`s "the numbers of rows in")]]

]


---

.pull-left[

## functions with default arguments

--

e.g. `log()` in R defaults to `\(\log_{e}()\)`:


```r
args(log)
```

```
## function (x, base = exp(1)) 
## NULL
```

therefore, an argument with a default can be left un-specified:


```r
log(exp(5))
```

_Note_ this is different from not declaring the _name_ for a no-default argument


```r
args(aes)
```

```
## function (x, y, ...) 
## NULL
```


```r
ggplot(gdp_by_year, aes(year, med_gdp))
```
]

--

.pull-right[

## functions where defaults are not documented


```r
args(geom_point)
```

```
## function (mapping = NULL, data = NULL, stat = "identity", position = "identity", 
##     ..., na.rm = FALSE, show.legend = NA, inherit.aes = TRUE) 
## NULL
```



```r
ggplot(gdp_by_year, aes(year, med_gdp)) +
* geom_point() +
  labs(x = "Year", y = "GDP per capita")
```

&lt;img src="2019-math-camp-R_day-01_files/figure-html/unnamed-chunk-47-1.svg" width="100%" /&gt;

]

---

## functions with countably infinite arguments

.pull-left[


```r
count(x = gss_cat, race)
```
.right[.small[(one-way tabulation)]]
&lt;br&gt;


```r
count(x = gss_cat, race, relig)
```
.right[.small[(two-way tabulation)]]

&lt;br&gt;



```r
count(x = gss_cat, race, relig, denom)
```
.right[.small[(three-way tabulation)]]

&lt;br&gt;

`args(count)` gives:
]


.pull-right[


some other arguments in the same function could be _are named_


```r
count(gss_cat, race, relig, sort = TRUE)
```

```
## # A tibble: 44 x 3
##    race  relig          n
##    &lt;fct&gt; &lt;fct&gt;      &lt;int&gt;
##  1 White Protestant  8188
##  2 White Catholic    4001
##  3 White None        2816
##  4 Black Protestant  2271
##  5 Other Catholic     916
##  6 White Christian    474
##  7 Other Protestant   387
##  8 Black None         384
##  9 White Jewish       370
## 10 Other None         323
## # … with 34 more rows
```

so cannot be implicitly called. Consider:



```r
count(gss_cat, race, relig, TRUE) # wrong
```

]




```
## function (x, ..., wt = NULL, sort = FALSE, name = "n", .drop = group_by_drop_default(x)) 
## NULL
```

--

R defined such potentially infinite arguments with `...` (an ellipsis)


---

## dplyr's pipe

* Invented for a convenient "and then"
  
  ```r
  weo %&gt;% 
      filter(country == "Africa") %&gt;% 
      select(country, rgdp1992, pop1992) %&gt;% 
      mutate(gdp_pc = rgdp1992 / pop1992)
  ```

--

* The object to `%&gt;%`'s LEFT becomes the _value of the first argument_ of the function to `%&gt;%`'s RIGHT
  
  ```r
  weo %&gt;% 
  * filter(country == "Africa")
  ```

--

* Therefore the first chunk is equivalent to:
  
  ```r
  mutate(select(filter(weo, country == "Africa"), rgdp1992, pop1992), gdp_pc = rgdp1992 / pop1992)
  ```

.right[.small[Remark: this follows the formal definition of a function, but is much less readable]]

--

* [Advanced topic]: A dataframe in a pipeline is implicitly kept "in scope" (a technical term), such that a variable name that is called is presumed to be from the dataframe.

---

## ggplot's plus


.left-threeway[
* Historically, `ggplot` came before `tidyverse` and `dplyr`

* Back then, layers were appended by the `+`

&lt;img src="images/ggplot-grammar.png" width="100%" style="display: block; margin: auto;" /&gt;

]

--


.right-plot[

```r
# format dataset
weo_percap &lt;- weo %&gt;% 
  mutate(pc_1992 = rgdp1992/pop1992,
         pc_2007 = rgdp2017/pop2017)

# ggplot
ggplot(weo_percap, aes(pc_1992, pc_2007)) +
  ## layers
  geom_abline(slope = 1, 
              intercept = 0, 
              linetype = "dashed") +
  geom_point(size = 0.5, color = "indianred") + 
  ## coordinate
  coord_equal() +
  ## facet 
  facet_wrap(~continent) +
  ## scale
  scale_x_continuous(labels = NULL) +
  scale_y_continuous(labels = dollar) +
  labs(x = "1992 GDP per capita",
       y = "2007 GDP per capita",
       title = "Growth between 1992 and 2017") +
  ## theme
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, face = "bold"))
ggsave("images/day1gg-show.png", w  = 4.8, height = 3.2)
```
]

---

## ggplot's plus


.left-code[

```r
# format dataset
weo_percap &lt;- weo %&gt;% 
  mutate(pc_1992 = rgdp1992/pop1992,
         pc_2007 = rgdp2017/pop2017)

# ggplot
ggplot(weo_percap, aes(pc_1992, pc_2007)) +
  ## layers
  geom_abline(slope = 1, 
              intercept = 0, 
              linetype = "dashed") +
  geom_point(size = 0.5, color = "indianred") + 
  ## coordinate
  coord_equal() +
  ## facet 
  facet_wrap(~continent) +
  ## scale
  scale_x_continuous(labels = NULL) +
  scale_y_continuous(labels = dollar) +
  labs(x = "1992 GDP per capita",
       y = "2007 GDP per capita",
       title = "Growth between 1992 and 2017") +
  ## theme
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, face = "bold"))
ggsave("images/day1gg-show.png", w  = 4.8, height = 3.2)
```
]

.right-plot[
&lt;img src="images/day1gg-show.png" width="100%" style="display: block; margin: auto;" /&gt;

]

---
class: middle, left

Coming up 

1. ~~Basics of tidyverse~~
2. Basics beyond tidyverse
3. Visualization
4. Communicating
5. Presentations!


---

class: middle center

# Try the exercises provided in your RStudio day 1 space.
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"highlightSpans": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
