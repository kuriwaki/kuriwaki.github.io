<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Math Camp R Sessions - Day 2</title>
    <meta charset="utf-8" />
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="xaringan_style.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Math Camp R Sessions - Day 2
## Shiro Kuriwaki

---





class: middle

# Day 2 - R beyond the tidyverse

## Group project preview
## function anatomy
## base-R syntax: vectors and lists
## strings, factors, numerics, and coercion
## formula syntax cross-tabs

.small-note[
**Notes:**


\* References for today's material: &lt;a href = "https://r4ds.had.co.nz"&gt;&lt;i&gt;R for Data Science&lt;/i&gt;&lt;/a&gt;  chs. &lt;a href = "https://r4ds.had.co.nz/factors.html"&gt;15&lt;/a&gt;, &lt;a href = "https://r4ds.had.co.nz/pipes.html"&gt;18&lt;/a&gt;, and &lt;a href = "https://r4ds.had.co.nz/vectors.html"&gt;20&lt;/a&gt;; and &lt;a href = "https://rstudio-education.github.io/hopr"&gt;&lt;i&gt;Hands-on Programming with R&lt;/i&gt;&lt;/a&gt; chs. &lt;a href = "https://rstudio-education.github.io/hopr/basics.html"&gt;2&lt;/a&gt; through &lt;a href = "https://rstudio-education.github.io/hopr/r-notation"&gt;6&lt;/a&gt;.
]

---

class: middle

# Housekeeping

* Announcements by Dan and Jake
* How to get files and submit assignments on Canvas
* Open the rstudio cloud session for today (`03_Day-02`)
* Read in the datasets we'll use


```r
library(tidyverse)
library(readxl)

weo &lt;- read_excel("data/input/WEO-2018.xlsx")
weo_long &lt;- read_csv("data/input/WEO-2018_long.csv")
data(gss_cat)
```

* How to ask questions

---

# Group Project (8/27): How does climate change affect economic growth / politics?

.pull-left[

&lt;img src="images/nytimes-climate.png" width="100%" /&gt;

]

.pull-right[

We'll use data from:

&lt;img src="images/dell_et_al_abstract.png" width="100%" /&gt;

same format as `WEO-2018_long.csv`, contains temperature, precipitation, and growth data.

]

---

# Group Project (8/27): How does climate change affect economic growth / politics?


.pull-left[

## for next Tuesday:

Short Submission: A standalone &lt;mark&gt;graph / table&lt;/mark&gt; testing whether hot countries tend to be poor. 

Group Presentation: A data-driven &lt;mark&gt;report&lt;/mark&gt; showing if / how climate change affects growth.
 
 - Focus on the tools for data exploration and visualization we learn in math camp
 - That means: don't worry about the econometrics

]

.pull-right[

We'll use data from:

&lt;img src="images/dell_et_al_abstract.png" width="100%" /&gt;

same format as `WEO-2018_long.csv`, contains temperature, precipitation, and growth data.

]

---

class: middle




# Ready with your datasets?


```r
library(tidyverse)
library(readxl)

weo &lt;- read_excel("data/input/WEO-2018.xlsx")
weo_long &lt;- read_csv("data/input/WEO-2018_long.csv")
data(gss_cat)

gdp_by_year &lt;- weo_long %&gt;% 
  group_by(year) %&gt;% 
  summarize(med_gdp = median(rgdp, na.rm = TRUE))
```


---
class: middle, center

# Function Anatomy

---

* _function_ (in mathematics): a mapping from each element of a set `\(X\)` a _single_ element of a set `\(Y\)`"

    In R: a process that takes one or more inputs (in parentheses) and returns exactly one output
    
    ```r
    log(x = 100, base = 10)
    ```

--


* Call a function by the function name, with arguments and values in parentheses, separated by commas
    
    ```r
    log(x = 100, base = 10)
    log(base = 10, x = 100)
    ```

--



* If the user does not name the arguments, they are assumed to come in the order they are defined.
    
    ```r
    log(100, 10)
    ```

--


* &lt;mark&gt;How do you know that the &lt;b&gt;first&lt;/b&gt; argument of &lt;font face = "Ubuntu Mono"&gt;log()&lt;/font&gt; is &lt;font face = "Ubuntu Mono"&gt;x&lt;/font&gt;, and not &lt;font face = "Ubuntu Mono"&gt;base&lt;/font&gt;?&lt;/mark&gt;

---

# Function anatomy: important odds and ends

--

.pull-left[

## 1. functions with no output


These functions still do something, but they are side-effects (no object output)


```r
library(tidyverse)
```
.small[.right[(loads the package)]]

&lt;br&gt;


```r
data(gss_cat)
```
.small[.right[(loads a built-in dataset which will be called `gss_cat`)]]

]

--

.pull-right[

## 2. functions with no arguments



```r
Sys.Date()
```

```
## [1] "2019-08-25"
```

.small[.right[(prints the date regardless of input)]]


```r
n()
```
.small[.right[(`dplyr`s "the numbers of rows in")]]

]


---

.pull-left[

## 3. functions with default arguments


e.g. `log()` in R defaults to `\(\log_{e}()\)`:


```r
args(log)
```

```
## function (x, base = exp(1)) 
## NULL
```

therefore, an argument with a default can be left un-specified:


```r
log(exp(5))
```

_Note_ this is different from not declaring the _name_ for a no-default argument


```r
args(aes)
```

```
## function (x, y, ...) 
## NULL
```


```r
ggplot(gdp_by_year, aes(year, med_gdp))
```
]

--

.pull-right[

## 4. functions where defaults are not documented


```r
args(geom_point)
```

```
## function (mapping = NULL, data = NULL, stat = "identity", position = "identity", 
##     ..., na.rm = FALSE, show.legend = NA, inherit.aes = TRUE) 
## NULL
```



```r
ggplot(gdp_by_year, aes(year, med_gdp)) +
* geom_point() +
  labs(x = "Year", y = "GDP per capita")
```

&lt;img src="2019-math-camp-R_day-02_files/figure-html/unnamed-chunk-20-1.svg" width="100%" /&gt;

]

---

## 5. functions with countably infinite arguments

.pull-left[


```r
count(x = gss_cat, race)
```
.right[.small[(one-way tabulation)]]


```r
count(x = gss_cat, race, relig)
```
.right[.small[(two-way tabulation)]]



```r
count(x = gss_cat, race, relig, denom)
```
.right[.small[(three-way tabulation)]]


Notice `args(count)` returns: 


```r
function (x, `...`, wt = NULL, sort = FALSE
```

R represents such potentially infinite arguments with `...` (an ellipsis)

]

--

.pull-right[


other arguments could be _named_


```r
count(gss_cat, race, relig, sort = TRUE)
```

```
## # A tibble: 44 x 3
##    race  relig          n
##    &lt;fct&gt; &lt;fct&gt;      &lt;int&gt;
##  1 White Protestant  8188
##  2 White Catholic    4001
##  3 White None        2816
##  4 Black Protestant  2271
##  5 Other Catholic     916
##  6 White Christian    474
##  7 Other Protestant   387
##  8 Black None         384
##  9 White Jewish       370
## 10 Other None         323
## # … with 34 more rows
```

so cannot be implicitly called. Consider:



```r
count(gss_cat, race, relig, TRUE) # wrong
```

]


--



---

## 6. dplyr's pipe

* tidyverse invented the `%&gt;%` for a convenient "and then"
  
  ```r
  weo %&gt;% 
      filter(continent == "Africa") %&gt;% 
      select(country, rgdp1992, pop1992) %&gt;% 
      mutate(gdp_pc = rgdp1992 / pop1992)
  ```

--

* The object to `%&gt;%`'s LEFT becomes the _value of the first argument_ of the function to `%&gt;%`'s RIGHT
  
  ```r
  weo %&gt;% 
  * filter(continent == "Africa")
  ```

--

* Therefore the first chunk is equivalent to:
  
  ```r
  mutate(select(filter(weo, continent == "Africa"), rgdp1992, pop1992), gdp_pc = rgdp1992 / pop1992)
  ```

.right[.small[Remark: this follows the formal definition of a function, but is much less readable]]

--

* &lt;font color = "gray"&gt;[Advanced]: A dataframe in a pipeline is implicitly kept "in scope", such that a variable name that is called is presumed to be from the dataframe. &lt;/font&gt;

---

## 7. ggplot's plus


.left-threeway[
* Historically, `ggplot` came before `tidyverse` and `dplyr`

* Appending layers by `+` (instead of `%&gt;%`) is a historical legacy

--

&lt;img src="images/ggplot-grammar.png" width="100%" style="display: block; margin: auto;" /&gt;

]

--


.right-plot[
.small[

```r
# format dataset
weo_percap &lt;- weo %&gt;% 
  mutate(pc_1992 = rgdp1992/pop1992,
         pc_2007 = rgdp2017/pop2017)

# ggplot
ggplot(weo_percap, aes(pc_1992, pc_2007)) +
  ## layers
  geom_abline(slope = 1, 
              intercept = 0, 
              linetype = "dashed") +
  geom_point(size = 0.5, color = "indianred") + 
  ## coordinate
  coord_equal() +
  ## facet 
  facet_wrap(~continent) +
  ## scale
  scale_x_continuous(labels = NULL) +
  scale_y_continuous(labels = dollar) +
  labs(x = "1992 GDP per capita",
       y = "2007 GDP per capita",
       title = "Growth between 1992 and 2017") +
  ## theme
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, face = "bold"))
ggsave("images/day1gg-show.png", w  = 4.8, height = 3.2)
```
]
]

---

## 7. ggplot's plus


.left-code[
.small[

```r
# format dataset
weo_percap &lt;- weo %&gt;% 
  mutate(pc_1992 = rgdp1992/pop1992,
         pc_2007 = rgdp2017/pop2017)

# ggplot
ggplot(weo_percap, aes(pc_1992, pc_2007)) +
  ## layers
  geom_abline(slope = 1, 
              intercept = 0, 
              linetype = "dashed") +
  geom_point(size = 0.5, color = "indianred") + 
  ## coordinate
  coord_equal() +
  ## facet 
  facet_wrap(~continent) +
  ## scale
  scale_x_continuous(labels = NULL) +
  scale_y_continuous(labels = dollar) +
  labs(x = "1992 GDP per capita",
       y = "2007 GDP per capita",
       title = "Growth between 1992 and 2017") +
  ## theme
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, face = "bold"))
ggsave("images/day1gg-show.png", w  = 4.8, height = 3.2)
```
]
]

.right-plot[
&lt;img src="images/day1gg-show.png" width="100%" style="display: block; margin: auto;" /&gt;

]

---
class: center, middle


# Questions?



---

# Three broad flavors of syntax

## 1. tidyverse syntax



```r
weo `%&gt;%`
  `mutate(gdp_pc_2017 = rgdp2017 / pop2017)`
```

.right[.small[Create a new variable]]


## 2. base-R (dollar sign and square bracket) syntax


```r
weo`$`gdp_pc_2017 &lt;- weo`$`rgdp2017 / weo`$`pop2017
weo`[["`gdp_pc_2017`"]]` &lt;- weo`[["`rgdp2017`"]]` / weo`[["`pop2017`"]]`
```

.right[.small[Create a new variable]]

## 3. formula (tilde) syntax

.pull-left[



```r
lm(tvhours `~` race `+` relig, data = gss_cat)
```

.right[.small[Run regressions]]
]

.pull-right[

```r
xtabs(`~` race `+` relig, data = gss_cat)
```

.right[.small[Cross-tab]]

]

---
class: middle, center

# A Whirlwind Tour of Base-R

## Data structures
## Data types
## Summary functions


---

# Data Structures: what's the container?

## data frames is the most complex data structure

|      | Homogeneous     | Heterogeneous           |
| -----:| :-------------: |:-------------:|
| 1-dimensional| Atomic Vector   | List |
| 2-dimensional | Matrix   | &lt;mark&gt;Data frame&lt;/mark&gt; |

&lt;br&gt;


## "Heterogeneous" means it can take different types


```r
x &lt;- list(1:3, "a", c(TRUE, FALSE, TRUE), c(2.3, 5.9))
str(x)
```

```
## List of 4
##  $ : int [1:3] 1 2 3
##  $ : chr "a"
##  $ : logi [1:3] TRUE FALSE TRUE
##  $ : num [1:2] 2.3 5.9
```


---

# tidyverse vs. syntax have different ways of subsetting

.pull-left[

## tidyverse (dataframes only)


```r
weo %&gt;% 
  select(country, rgdp2017) %&gt;% 
  slice(1:5)
```

```
## # A tibble: 5 x 2
##   country             rgdp2017
##   &lt;chr&gt;                  &lt;dbl&gt;
## 1 Afghanistan           63353.
## 2 Albania               32763.
## 3 Algeria              576494.
## 4 Angola               173327.
## 5 Antigua and Barbuda    2174.
```


]



## base-R

.pull-right[

Atomic vectors with square brackets 

   
   ```r
   letters[c(1, 2, 3)]
   ```

Matrices also with square brackets -- with two dimensions:

   
   ```r
   weo[1:5, 1]
   ```


Lists with double square brackets or `$` (S for &lt;mark&gt;S&lt;/mark&gt;lot)

   
   ```r
   weo[[1]]
   weo[["country"]]
   weo$country
   ```

]




---

# Data types: what's in the container?

--

.left-threeway[

(a) Logical


```r
c(TRUE, FALSE, FALSE)
```

&lt;br&gt;


```r
is.na(c(NA, 2, 3))
```

```
## [1]  TRUE FALSE FALSE
```

]

.center-threeway[

(b) Numeric - Integers


```r
c(1L, 0L, 0L)
```

&lt;br&gt;


(c) Numeric - Doubles


```r
c(1, 0, 0)
```


]

.right-threeway[

(d) Character 


```r
c("A", "B", "B")
```

]


---

# Vectors are flexible:

.left-threeway[

## coercion

`TRUE` gets coerced to 1 and `FALSE` gets coerced to 0:


```r
sum(c(TRUE, FALSE, TRUE))
```

```
## [1] 2
```


numbers can be coerced to characters:


```r
as.character(c(1, 2, 3))
```


automatic coercion makes vectors stay homogeneous:


```r
c(1, "a")
```

]

--

.center-threeway[

## recycling

A scalar assigned to become a vector will be transformed into a _vector_ with its values repeated.


```r
weo$ones &lt;- 1
```

This created a column called `ones` where every row is the number ones.


```r
count(weo, ones)
```

```
## # A tibble: 1 x 2
##    ones     n
##   &lt;dbl&gt; &lt;int&gt;
## 1     1   191
```

]

--

.right-threeway[

## vector algebra

Numeric vectors and matrices follow the rules of algebra


```r
c(1, 2, 3) + c(100, 200, 300)
```

```
## [1] 101 202 303
```


```r
c(1, 2, 3) * c(100, 200, 300)
```

```
## [1] 100 400 900
```

recycling works here too:


```r
(c(1, 2, 3) * c(100, 200, 300)) + 1
```

```
## [1] 101 401 901
```


]

---


# factors: a hybrid type that encodes the order of values

--

* In practice, factors are like _ordered_ characters

--

* Technically,  factors integers (which dictates the ordering, called __levels__) where each value has a __label__

--

.pull-left[

## built-in GSS saves variables as factors 


```r
data(gss_cat)
count(gss_cat, marital)
```

```
## # A tibble: 6 x 2
##   marital           n
##   &lt;fct&gt;         &lt;int&gt;
## 1 No answer        17
## 2 Never married  5416
## 3 Separated       743
## 4 Divorced       3383
## 5 Widowed        1807
## 6 Married       10117
```
]

.pull-right[

## compare this to strings


```r
gss_str &lt;- read_csv("data/input/gss_str.csv")
count(gss_str, marital)
```

```
## # A tibble: 6 x 2
##   marital           n
##   &lt;chr&gt;         &lt;int&gt;
## 1 Divorced       3383
## 2 Married       10117
## 3 Never married  5416
## 4 No answer        17
## 5 Separated       743
## 6 Widowed        1807
```
]

---

# Recoding, Releveling, and Replacing


## 1. dplyr::recode edits the values


```r
gss_cat %&gt;% 
  mutate(relig = 
*          recode(relig,
*                 Protestant = "Christian",
*                 Catholic = "Christian",
*                 .default = "Non-Christian")) %&gt;%
  count(relig)
```

```
## # A tibble: 2 x 2
##   relig             n
##   &lt;fct&gt;         &lt;int&gt;
## 1 Non-Christian  5513
## 2 Christian     15970
```

---
# Recoding, Releveling, and Replacing


## 2. forcats::fct\_relevel edits the _order_ of the levels


```r
count(gss_cat, race)
```

```
## # A tibble: 3 x 2
##   race      n
##   &lt;fct&gt; &lt;int&gt;
## 1 Other  1959
## 2 Black  3129
## 3 White 16395
```


```r
gss_cat %&gt;% 
* mutate(race = fct_relevel(race, "White", "Black", "Other")) %&gt;%
  count(race)
```

```
## # A tibble: 3 x 2
##   race      n
##   &lt;fct&gt; &lt;int&gt;
## 1 White 16395
## 2 Black  3129
## 3 Other  1959
```

---
# Recoding, Releveling, and Replacing


## 3. base::replace edits the value of variables based on the value of potentially other variables



```r
gss_cat %&gt;% 
  mutate(is_senior = NA,  # this makes a columns of NAs
         is_senior = replace(is_senior, `age &lt; 65`,  "not senior"),
         is_senior = replace(is_senior, `age &gt;= 65`, "senior")) %&gt;% 
  select(age, is_senior)
```



```
## # A tibble: 21,483 x 2
##      age is_senior 
##    &lt;int&gt; &lt;chr&gt;     
##  1    26 not senior
##  2    48 not senior
##  3    67 senior    
##  4    39 not senior
##  5    25 not senior
##  6    25 not senior
##  7    36 not senior
##  8    44 not senior
##  9    44 not senior
## 10    47 not senior
## # … with 21,473 more rows
```
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"highlightSpans": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
