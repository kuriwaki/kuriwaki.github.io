<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Math Camp R Sessions</title>
    <meta charset="utf-8" />
    <meta name="author" content="Shiro Kuriwaki" />
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="xaringan_style.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Math Camp R Sessions
## Day 3
### Shiro Kuriwaki
### August 2019

---






```r
library(tidyverse)
library(readxl)

weo_long &lt;- read_csv("data/input/WEO-2018_long.csv")
alesina &lt;- read_excel("data/input/intergenerational-mobility.xlsx")
```


---

class: middle, center

# Day 3 Agenda (Visualization)

## how our eyes see data
## technicalities: axes, legends, annotation, exporting
## day 2 remainders: functions for base-R  and formula syntax

---
class: center, middle


# Visualization

&lt;br&gt;

.right[.small[Many of the figures presented here come from Claus Wilke's book, and many ideas from John Rauser's talk. See Syllabus.]]

---

# 1. Show the key message as a comparison of positions on a common scale

&lt;br&gt;

Perception tasks, ranked

1. &lt;u&gt;Position along a common scale&lt;/u&gt; &lt;font color = "red"&gt; &amp;#x2b05; the human eye can discern this most accurately &lt;/font&gt;
2. Position along identical, nonaligned scales
3. Length
4. Angle or Slope
5. Area
6. Volume, Density, Saturation
7. Color Hue  &lt;font color = "red"&gt; &amp;#x2b05; and this the least&lt;/font&gt;


.right[.small[Source: &lt;a href = "https://pdfs.semanticscholar.org/565d/843c2c0e60915709268ac4224894469d82d5.pdf"&gt;Cleveland and McGill (1985)&lt;/a&gt;, paper on Canvas]]





---

# Example: Alesina et al., "Intergenerational mobility in Africa" (&lt;a href="https://voxdev.org/topic/health-education/intergenerational-mobility-africa"&gt;link&lt;/a&gt;)


```r
alesina &lt;- read_excel("data/input/intergenerational-mobility.xlsx")
```

.pull-left[

&lt;img src="images/papaioannou21junefig1a.png" width="90%" /&gt;

]

--

.pull-right[


&lt;img src="images/papaioannou21junetable1.png" width="75%" /&gt;

]



---


.left-code[
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;

1. Position along a common scale &lt;font color = "red"&gt; &amp;#x2b05; the human eye can discern this most accurately &lt;/font&gt;
2. Position along identical, nonaligned scales
3. Length
4. Angle or Slope
5. Area
6. Volume, Density, Saturation
7. &lt;mark&gt;Color Hue&lt;/mark&gt;&lt;font color = "red"&gt; &amp;#x2b05; and this the least&lt;/font&gt;
]

--

.right-plot[

![](2019-math-camp-R_day-03_files/figure-html/unnamed-chunk-6-1.svg)&lt;!-- --&gt;
]


---


.left-code[
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;

1. Position along a common scale &lt;font color = "red"&gt; &amp;#x2b05; the human eye can discern this most accurately &lt;/font&gt;
2. Position along identical, nonaligned scales
3. Length
4. Angle or Slope
5. Area
6. Volume, Density, Saturation
7. &lt;mark&gt;Color Hue&lt;/mark&gt;  &lt;font color = "red"&gt; &amp;#x2b05; and this the least&lt;/font&gt;

&lt;br&gt;
Using: `geom_col()` with the `fill` aesthetic, reordering countries by `fct_reorder()`.
]

.right-plot[

![](2019-math-camp-R_day-03_files/figure-html/unnamed-chunk-7-1.svg)&lt;!-- --&gt;
]

---


.left-code[
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;

1. Position along a common scale &lt;font color = "red"&gt; &amp;#x2b05; the human eye can discern this most accurately &lt;/font&gt;
2. Position along identical, nonaligned scales
3. Length
4. Angle or Slope
5. Area
6. Volume, Density, &lt;mark&gt;Saturation&lt;/mark&gt;
7. Color Hue &lt;font color = "red"&gt; &amp;#x2b05; and this the least&lt;/font&gt;

&lt;br&gt;
Using: defining a color scale with `scale_fill_distiller(palette = "Reds")`.
]

.right-plot[

![](2019-math-camp-R_day-03_files/figure-html/unnamed-chunk-8-1.svg)&lt;!-- --&gt;

]

---



.left-code[
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;

1. Position along a common scale &lt;font color = "red"&gt; &amp;#x2b05; the human eye can discern this most accurately &lt;/font&gt;
2. Position along identical, nonaligned scales
3. &lt;mark&gt;Length&lt;/mark&gt;
4. Angle or Slope
5. Area
6. Volume, Density, Saturation
7. Color Hue &lt;font color = "red"&gt; &amp;#x2b05; and this the least&lt;/font&gt;

&lt;br&gt;
Using: `geom_segment()`
]

.right-plot[

![](2019-math-camp-R_day-03_files/figure-html/unnamed-chunk-9-1.svg)&lt;!-- --&gt;
]


---

.left-code[
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;

1. &lt;mark&gt;Position along a common scale&lt;/mark&gt; &lt;font color = "red"&gt; &amp;#x2b05; the human eye can discern this most accurately &lt;/font&gt;
2. Position along identical, nonaligned scales
3. Length
4. Angle or Slope
5. Area
6. Volume, Density, Saturation
7. Color Hue &lt;font color = "red"&gt; &amp;#x2b05; and this the least&lt;/font&gt;

&lt;br&gt;
Using: `geom_col()`
]


.right-plot[

![](2019-math-camp-R_day-03_files/figure-html/unnamed-chunk-10-1.svg)&lt;!-- --&gt;
]


---

.left-code[
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;

1. &lt;mark&gt;Position along a common scale&lt;/mark&gt; &lt;font color = "red"&gt; &amp;#x2b05; the human eye can discern this most accurately &lt;/font&gt;
2. Position along identical, nonaligned scales
3. Length
4. Angle or Slope
5. Area
6. Volume, Density, Saturation
7. Color Hue &lt;font color = "red"&gt; &amp;#x2b05; and this the least&lt;/font&gt;

&lt;br&gt;
Using: `geom_point()`
]


.right-plot[

![](2019-math-camp-R_day-03_files/figure-html/unnamed-chunk-11-1.svg)&lt;!-- --&gt;
]

---

.left-code[
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;

1. &lt;mark&gt;Position along a common scale&lt;/mark&gt; &lt;font color = "red"&gt; &amp;#x2b05; the human eye can discern this most accurately &lt;/font&gt;
2. Position along identical, nonaligned scales
3. Length
4. Angle or Slope
5. Area
6. Volume, Density, Saturation
7. Color Hue  &lt;font color = "red"&gt; &amp;#x2b05; and this the least&lt;/font&gt;

&lt;br&gt;
Using: `geom_point()`
]


.right-plot[

![](2019-math-camp-R_day-03_files/figure-html/unnamed-chunk-12-1.svg)&lt;!-- --&gt;
]

---

.left-code[
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;

1. &lt;mark&gt;Position along a common scale&lt;/mark&gt; &lt;font color = "red"&gt; &amp;#x2b05; the human eye can discern this most accurately &lt;/font&gt;
2. Position along identical, nonaligned scales
3. Length
4. Angle or Slope
5. Area
6. Volume, Density, Saturation
7. Color Hue&lt;font color = "red"&gt; &amp;#x2b05; and this the least&lt;/font&gt;

&lt;br&gt;
Using: `geom_point()` and `geom_errorbar()`
]

.right-plot[

![](2019-math-camp-R_day-03_files/figure-html/unnamed-chunk-13-1.svg)&lt;!-- --&gt;
]

---

.left-code[
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;

1. &lt;mark&gt;Position along a common scale&lt;/mark&gt; &lt;font color = "red"&gt; &amp;#x2b05; the human eye can discern this most accurately &lt;/font&gt;
2. Position along identical, nonaligned scales
3. Length
4. Angle or Slope
5. Area
6. Volume, Density, Saturation
7. Color Hue &lt;font color = "red"&gt; &amp;#x2b05; and this the least&lt;/font&gt;

&lt;br&gt;
Using: `geom_point()` and `geom_errorbar()`
]


.right-plot[

![](2019-math-camp-R_day-03_files/figure-html/unnamed-chunk-14-1.svg)&lt;!-- --&gt;
]

---

# 1. Show the key message as a comparison of positions on a common scale




&lt;img src="images/how-humans-see.png" width="100%" style="display: block; margin: auto;" /&gt;

---

# 2. Maximize the Data-to-Ink ratio (i.e. proactively remove superficial ink)


&lt;img src="images/cwilke_table-examples-1.png" width="75%" style="display: block; margin: auto;" /&gt;



---

# 3. Avoid excessive overlap (instead, use small multiples)

.pull-left[

## bad

&lt;img src="images/cwilke_popgrowth-vs-popsize-colored-1.png" width="80%" /&gt;

]

.pull-right[

## bad
&lt;img src="images/papaioannou21junefig4.png" width="789" /&gt;


]

---


**Solution**  In ggplot, "facet" your graphs by `facet_grid()` (a rigid table) or `facet_wrap()` (wrap long lines).


```r
ggplot(weo_long, aes(x = year, y = (rgdp/pop), group = country)) +
* facet_wrap(~ continent) + # formula syntax
  geom_line() +
  labs(x = "Year", y = "GDP per capita")
```

&lt;img src="images/country_facet.png" width="75%" /&gt;

---
class: center, middle

End of part 1 of 2

&lt;mark&gt;Try Problem 7 part (1) &lt;/mark&gt;



---
class: center, middle


# Important Technicalities




---

# 1. Clear and concise axis titles

## Always label your axes, but don't make it verbose either

.pull-left[

&lt;img src="images/cwilke_tech-stocks-minimal-labeling-bad-1.png" width="1536" /&gt;

]

.pull-right[

&lt;img src="images/cwilke_tech-stocks-labeling-ugly-1.png" width="1536" /&gt;

]

---

# 1. Clear and concise axis titles


.pull-left[
&lt;img src="images/cwilke_tech-stocks-minimal-labeling-1.png" width="1536" /&gt;
]

.pull-right[

pseudo-code:


```r
ggplot(stocks, 
       aes(x = year, 
           y = price, 
           group = company,
           color = company)) + 
* labs(x = "",
*      y = "stock price, indexed",
*      color = "")
```
]



---

# 2. Reasonable font and image sizes

## The default image size is almost always too large, making the labels illegible 

.pull-left[

&lt;img src="images/cwilke_Aus-athletes-small-1.png" width="1536" /&gt;

]

.pull-right[


&lt;img src="images/cwilke_Aus-athletes-big-good-1.png" width="1536" /&gt;

]

--

**Solution**: save the images in _smaller size_ (I recommend 3 by 5 inches; some recommend smaller).


```r
ggsave("figures/figure_rightsize.pdf", `height = 3`, `width = 5`)
```

---

# Also: Use vector graphics (high resolution) where possible


&lt;img src="images/cwilke_bitmap-zoom-1.png" width="100%" /&gt;

Note: panel (b) zooms into the figure in panel (a) when the graph is a raster graphic (like `jpeg` or `png`). panel (c) zooms into the same area when the graph is a vector graphic (like `pdf` or `svg`).


---

# 3. Reader-friendly legends or annotation

## Having to go back and forth between data and legend is not reader-friendly.

.pull-left[

&lt;img src="images/cwilke_tech-stocks-bad-legend-1.png" width="1536" /&gt;

]

--

.pull-right[

&lt;img src="images/cwilke_tech-stocks-good-legend-1.png" width="1536" /&gt;

]


**Solution**: relevel your factors (`fct_relevel`) so the levels align with the data, or ...

---

# Whenever possible, design your figures so they donâ€™t need a legend.

.pull-left[

&lt;img src="images/cwilke_tech-stocks-good-no-legend-1.png" width="1536" /&gt;

]

.pull-right[

pseudo-code:


```r
ggplot(stocks, 
       aes(x = year, 
           y = price, 
           group = company,
           color = company)) + 
  annotate("text", x = 2018, y = 550, label = "Facebook") +
  annotate("text", x = 2018, y = 340, label = "Alphabet") +
  annotate("text", x = 2018, y = 250, label = "Microsoft") +
  annotate("text", x = 2018, y = 195, label = "Apple") +
  labs(x = "", 
       y = "stock price, indexed", 
       color = "color")
```


]

---

# 4. Default color scales can be indistinguishable in grayscale or for colorblind readers


.pull-left[

&lt;img src="images/cwilke_iris-scatter-one-shape-1.png" width="1536" /&gt;

]

--

.pull-right[

&lt;img src="images/cwilke_iris-scatter-one-shape-cvd-1.png" width="2011" /&gt;

]

--

&lt;b&gt;Solution&lt;/b&gt;: 

* The viridis color scale (`scale_color_viridis_d` or `scale_color_viridis_c`) is a good default.
* Also manually assign values for discrete variables ( `scale_color_manual`)

---
class: center, middle

# Day 2 Remainders

## types of extraction
## formula syntax


```r
weo &lt;- read_excel("data/input/WEO-2018.xlsx")
```


---

# The things you can get out of data

.pull-left[

## 1. dimensions


Each vector has a "length", each 2d array has a "dimension" 


```r
x &lt;- c(1:10)
length(x)
```


```
## [1] 10
```


```r
dim(weo)
```

```
## [1] 191  66
```


.right[.small[Also use  `nrow` (number of rows) and `ncol` (number of columns)]]

]

.pull-right[

## 2. summary stats




```r
stdnormals &lt;- rnorm(n = 1000, mean = 0, sd = 1)
```


```r
mean(stdnormals)
sd(stdnormals)
```


```
## [1] -0.007799939
```

```
## [1] 1.032668
```



```r
round(mean(stdnormals), digits = 2)
```

```
## [1] -0.01
```

]

---

# The things you can get out of data

.pull-left[

## 3. string concatenation


   
   ```r
   c("a", "b", "c", "d")
   ```
   
   ```
   ## [1] "a" "b" "c" "d"
   ```
concatenate ("paste") into a single item

   
   ```r
   str_c("a", "b", "c", "d")
   ```
   
   ```
   ## [1] "abcd"
   ```
   
]

--

.pull-right[

## 4. pulling out vectors from dataframes


```r
mean(weo$rgdp2019)
```

```
## [1] 653848.6
```



```r
mean(select(weo, rgdp2019))
```

```
## Warning in mean.default(select(weo, rgdp2019)): argument is not numeric or
## logical: returning NA
```

```
## [1] NA
```

"pull" takes one column and coerces to vector:


```r
mean(`pull`(weo, rgdp2019))
```


```
## [1] 653848.6
```

]

---


&lt;mark&gt; What would the following code do? &lt;/mark&gt;

   
   ```r
   weo_long %&gt;% 
     mutate(rgdp2017 = round(rgdp2017, digits = 0),
            country = str_c(country, " (", continent, ")")) %&gt;% 
     slice(1:3)
   ```

--

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; country &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; rgdp2017 &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Afghanistan (Asia) &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 63353 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Albania (Europe) &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 32763 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Algeria (Africa) &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 576494 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---
class: center, middle

# Formula syntax


---

# Formula (tilde) syntax expresses the relationship between variables

.pull-left[
OLS has a `formula` and a `data` argument


```r
fit &lt;- lm(tvhours ~ race + relig, data = gss_cat)
summary(fit)
```

* __One__ variable (unquoted) to the left hand side
* __One or more__ variables to the right hand side

]

--


.pull-right[
Formulas are not unique to regressions. See for example cross-tabs:


```r
xtabs(~ relig + race, gss_cat, drop = TRUE)
```

* Typically no left hand side
* __One or two__ variables to the right hand side (row variable, then column variable)


]

---


# Summarizing cross-tabs

Cell / row / column proportions



```r
prop.table(xtabs(~ relig + race, gss_cat))
prop.table(xtabs(~ relig + race, gss_cat), `margin = 1`)
prop.table(xtabs(~ relig + race, gss_cat), `margin = 2`)
```

--

&lt;br&gt;

Using the GSS dataset, how would you get &lt;mark&gt;a cross-tab that shows (a) the proportion in each income bin, (b) for each of the two most common values of race, and (c) _rounded_ to the second decimal point?  &lt;/mark&gt;

--


```r
gss_cat_wb &lt;- gss_cat %&gt;% 
  filter(race %in% c("White", "Black")) %&gt;% 
  mutate(race = as.character(race))

xtabs(~ rincome + race, gss_cat_wb) %&gt;% 
  prop.table(margin = 2) %&gt;% 
  round(2)
```
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"highlightSpans": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
